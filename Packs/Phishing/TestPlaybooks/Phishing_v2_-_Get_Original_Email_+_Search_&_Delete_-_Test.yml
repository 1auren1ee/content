id: Phishing v2 - Get Original Email + Search & Delete - Test
version: -1
name: Phishing v2 - Get Original Email + Search & Delete - Test
description: |-
  This playbook tests the search & delete and get original email functionality.
  Prerequisites:
  - The phishing playbook is configured with the correct inputs to allow getting the original email and searching & deleting emails
  - A mail sender with sr-test02 is configured. That user will supposedly attack sr-test01.
  - sr-test01 has a rule which forwards the test email to Avishai (but does not forward the acknowledgement emails it receives from the phishing playbook!)
  - EWS v2 is configured as the mail listener with Avishai as the user.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: 58acb61a-692f-4089-851c-d205b78517d0
    type: start
    task:
      id: 58acb61a-692f-4089-851c-d205b78517d0
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 50
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 8e232990-af6a-46f5-8f84-206059efbde6
    type: regular
    task:
      id: 8e232990-af6a-46f5-8f84-206059efbde6
      version: -1
      name: Delete Context
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "20"
    scriptarguments:
      all:
        simple: "yes"
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 185
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "4":
    id: "4"
    taskid: fefe4831-eea8-46c5-845a-ecc2c81e8ffd
    type: regular
    task:
      id: fefe4831-eea8-46c5-845a-ecc2c81e8ffd
      version: -1
      name: Investigate the incident
      description: commands.local.investigate
      script: Builtin|||investigate
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "23"
    scriptarguments:
      id:
        complex:
          root: foundIncidents.id
          accessor: '[0]'
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "5":
    id: "5"
    taskid: 892e6244-a4bc-4e68-8ab9-21e78a0e21cc
    type: playbook
    task:
      id: 892e6244-a4bc-4e68-8ab9-21e78a0e21cc
      version: -1
      name: Wait and manually remediate
      description: Waits for a certain task status, and/or completes the task.
      playbookName: Wait And Complete Task By Status
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "6"
    scriptarguments:
      CompleteTask:
        simple: "True"
      IncidentID:
        complex:
          root: FoundID
          transformers:
          - operator: uniq
      TaskName:
        simple: Manually remediate  the incident
      TaskStates:
        simple: Waiting
    separatecontext: true
    loop:
      iscommand: false
      builtincondition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: FoundTaskNames
            iscontext: true
          right:
            value:
              simple: Manually remediate  the incident
      exitCondition: ""
      wait: 10
      max: 300
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1160
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 2
    isoversize: false
    isautoswitchedtoquietmode: false
  "6":
    id: "6"
    taskid: 51099175-100a-4666-8d61-a56ffc1d8a66
    type: playbook
    task:
      id: 51099175-100a-4666-8d61-a56ffc1d8a66
      version: -1
      name: Wait for incident to close
      description: Waits for a certain task status, and/or completes the task.
      playbookName: Wait And Complete Task By Status
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "7"
      - "17"
      - "24"
      - "32"
    scriptarguments:
      CompleteTask:
        simple: "False"
      IncidentID:
        complex:
          root: FoundID
          transformers:
          - operator: uniq
      TaskName:
        simple: Close investigation
      TaskStates:
        simple: Completed
    separatecontext: true
    loop:
      iscommand: false
      builtincondition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: FoundTaskNames
            iscontext: true
          right:
            value:
              simple: Close investigation
      exitCondition: ""
      wait: 20
      max: 150
    view: |-
      {
        "position": {
          "x": 450,
          "y": 1340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "7":
    id: "7"
    taskid: c1e859ee-605c-4731-8b99-6a293b0e343f
    type: regular
    task:
      id: c1e859ee-605c-4731-8b99-6a293b0e343f
      version: -1
      name: Get the final Email context
      description: Gets a value from the specified incident's context.
      scriptName: GetByIncidentId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      get_key:
        simple: Email
      incident_id:
        complex:
          root: FoundID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 750,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "8":
    id: "8"
    taskid: d21cc98d-2923-4dfa-8277-2bba5eef0f65
    type: title
    task:
      id: d21cc98d-2923-4dfa-8277-2bba5eef0f65
      version: -1
      name: Incident Field Checks
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "15"
      - "16"
      - "29"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -100,
          "y": 1970
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "9":
    id: "9"
    taskid: 89264073-82e1-45f0-81a1-c1ce281fff1b
    type: title
    task:
      id: 89264073-82e1-45f0-81a1-c1ce281fff1b
      version: -1
      name: Context Checks
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "12"
      - "31"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1000,
          "y": 1960
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 7c6404e4-0109-4b5e-8da0-33816a5dbea8
    type: regular
    task:
      id: 7c6404e4-0109-4b5e-8da0-33816a5dbea8
      version: -1
      name: Get final incident fields
      description: Searches Demisto incidents
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "8"
    scriptarguments:
      id:
        complex:
          root: FoundID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -100,
          "y": 1790
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "12":
    id: "12"
    taskid: d0d3fcfd-0c96-49bc-8ca2-efdab3131e16
    type: condition
    task:
      id: d0d3fcfd-0c96-49bc-8ca2-efdab3131e16
      version: -1
      name: Does the retrieved email contain the correct HTML?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "13"
      "yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: Email
                accessor: HTML
            iscontext: true
          right:
            value:
              simple: http://157.230.37.22/banks/Scotia/
    view: |-
      {
        "position": {
          "x": 750,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: c489e238-b90a-4cc9-86f5-b110f721d84b
    type: regular
    task:
      id: c489e238-b90a-4cc9-86f5-b110f721d84b
      version: -1
      name: Error about mismatch in the email HTML
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: Something with the HTML of the retrieved email is wrong. Most likely,
          the original email was not retrieved.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 750,
          "y": 2330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "14":
    id: "14"
    taskid: af03b41b-f16a-4d0e-89a1-e4a44ce2eeba
    type: title
    task:
      id: af03b41b-f16a-4d0e-89a1-e4a44ce2eeba
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 460,
          "y": 2930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "15":
    id: "15"
    taskid: 25312a1c-0298-434b-88c3-67a81ea98244
    type: condition
    task:
      id: 25312a1c-0298-434b-88c3-67a81ea98244
      version: -1
      name: Was the subject of the original email set?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "19"
      "Yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: foundIncidents.CustomFields
                accessor: emailsubject
            iscontext: true
          right:
            value:
              simple: Suspicious activity in your bank account [ACTION REQUIRED]
    view: |-
      {
        "position": {
          "x": -100,
          "y": 2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "16":
    id: "16"
    taskid: 6af5f2fc-4dec-473b-8fc1-c5c2e0595e69
    type: condition
    task:
      id: 6af5f2fc-4dec-473b-8fc1-c5c2e0595e69
      version: -1
      name: Is the reporter address different than the phishing sender?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "28"
      "Yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "Yes"
      condition:
      - - operator: isNotEqualString
          left:
            value:
              complex:
                root: foundIncidents.CustomFields
                accessor: emailfrom
            iscontext: true
          right:
            value:
              complex:
                root: foundIncidents.CustomFields
                accessor: reporteremailaddress
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              complex:
                root: foundIncidents.CustomFields
                accessor: reporteremailaddress
            iscontext: true
    view: |-
      {
        "position": {
          "x": -580,
          "y": 2130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "17":
    id: "17"
    taskid: 14006d79-2992-47ef-8144-0ab99c8805f5
    type: title
    task:
      id: 14006d79-2992-47ef-8144-0ab99c8805f5
      version: -1
      name: Additional Flow Checks
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "18"
      - "25"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2090,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "18":
    id: "18"
    taskid: a4814f56-25e0-42ff-8c2b-808becdcdec7
    type: playbook
    task:
      id: a4814f56-25e0-42ff-8c2b-808becdcdec7
      version: -1
      name: Check that URL screenshot was taken
      description: Waits for a certain task status, and/or completes the task.
      playbookName: Wait And Complete Task By Status
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      CompleteTask:
        simple: "False"
      IncidentID:
        complex:
          root: FoundID
      TaskName:
        simple: Get URL screenshot
      TaskStates:
        simple: Completed
    separatecontext: true
    loop:
      iscommand: false
      builtincondition:
      - - operator: containsGeneral
          left:
            value:
              complex:
                root: FoundTaskNames
            iscontext: true
          right:
            value:
              simple: Get URL screenshot
      exitCondition: ""
      wait: 10
      max: 100
    view: |-
      {
        "position": {
          "x": 1800,
          "y": 1920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "19":
    id: "19"
    taskid: 52b7e0ca-c55b-4ac5-840d-7242a7ba8190
    type: regular
    task:
      id: 52b7e0ca-c55b-4ac5-840d-7242a7ba8190
      version: -1
      name: Error - subject is not the subject of the retrieved email
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: The subject of the retrieved email was not set in the Process Email
          - Generic playbook, or the original email was not retrieved at all.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -100,
          "y": 2330
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "20":
    id: "20"
    taskid: b9a3eb5a-0ce6-456b-8d15-132fe43d8aab
    type: regular
    task:
      id: b9a3eb5a-0ce6-456b-8d15-132fe43d8aab
      version: -1
      name: Send email from attacker to victim
      description: Sends an email using EWS.
      script: '|||send-mail'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "21"
    scriptarguments:
      body:
        simple: 'We''ve detected suspicious activity in your bank account on 05/12/2021.Please
          take a moment to review your recent activity and report anything suspicious
          immediately.Make sure to login and follow the instructions on our official
          website: www.scotiabank.com<https://eur01.safelinks.protection.outlook.com/?url=http%3A%2F%2F157.230.37.22%2Fbanks%2FScotia%2F&data=04%7C01%7Csr-test01%40demistodev.onmicrosoft.com%7Ca068915160cb49db31d508d9b9a33929%7Cebac1a1681bf449b8d435732c3c1d999%7C1%7C0%7C637744932980194392%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&sdata=I7reVHNGh7ifFcOWXFdfQWFXmwK3MVxFLEgiMPiG7Jo%3D&reserved=0>.Should
          you have any questions, please contact us at SUPPORT@SCOTlABANK.COMScotiabank'
      htmlBody:
        simple: '<div style="font-family: Calibri, Arial, Helvetica, sans-serif;font-size:
          12pt;color: rgb(0, 0, 0);"><span style="font-size: 12pt;background-color:
          rgb(255, 255, 255);">We&#39;ve detected suspicious activity in your bank account
          on 05/12/2021.</span> <div style="font-size: 12pt;background-color: rgb(255,
          255, 255);">Please take a moment to review your recent activity and report
          anything suspicious immediately.</div><div style="font-size: 12pt;background-color:
          rgb(255, 255, 255);">Make sure to login and follow the instructions on our
          official website:<span> </span><a href="https://eur01.safelinks.protection.outlook.com/?url=http%3A%2F%2F157.230.37.22%2Fbanks%2FScotia%2F&amp;data=04%7C01%7Csr-test01%40demistodev.onmicrosoft.com%7Ca068915160cb49db31d508d9b9a33929%7Cebac1a1681bf449b8d435732c3c1d999%7C1%7C0%7C637744932980194392%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000&amp;sdata=I7reVHNGh7ifFcOWXFdfQWFXmwK3MVxFLEgiMPiG7Jo%3D&amp;reserved=0"
          target="_blank" style="" rel="nofollow noopener">www.scotiabank.com</a>.</div><div
          style="font-size: 12pt;background-color: rgb(255, 255, 255);"><br></div><div
          style="font-size: 12pt;background-color: rgb(255, 255, 255);">Should you
          have any questions, please contact us at SUPPORT@SCOTlABANK.COM</div><span
          style="font-size: 12pt;background-color: rgb(255, 255, 255);"><span style="">Scotiabank</span></span><br></div>'
      subject:
        simple: Suspicious activity in your bank account [ACTION REQUIRED]
      to:
        simple: sr-test01@demistodev.onmicrosoft.com
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "21":
    id: "21"
    taskid: a41be1c7-27bf-4d49-87cd-b1b2ab9d7a4b
    type: regular
    task:
      id: a41be1c7-27bf-4d49-87cd-b1b2ab9d7a4b
      version: -1
      name: Wait for email to arrive and be forwarded by rule to Avishai
      description: Sleep for X seconds
      scriptName: Sleep
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "22"
    scriptarguments:
      seconds:
        simple: "120"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 505
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "22":
    id: "22"
    taskid: 0911b7d0-1778-4acb-8a8f-425bf6fd6b64
    type: regular
    task:
      id: 0911b7d0-1778-4acb-8a8f-425bf6fd6b64
      version: -1
      name: Find the new incident
      description: |-
        Searches Demisto incidents.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: SearchIncidentsV2
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    scriptarguments:
      name:
        simple: 'FW: Suspicious activity in your bank account [ACTION REQUIRED]'
      status:
        simple: Pending
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 670
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "23":
    id: "23"
    taskid: 08dfc829-2e42-4cee-8a2c-de763f7421c9
    type: regular
    task:
      id: 08dfc829-2e42-4cee-8a2c-de763f7421c9
      version: -1
      name: Save found incident ID
      description: Set a value in context under the key you entered.
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "5"
    scriptarguments:
      key:
        simple: FoundID
      value:
        complex:
          root: foundIncidents.id
          accessor: '[0]'
    reputationcalc: 1
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 450,
          "y": 980
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "24":
    id: "24"
    taskid: 10f8f2a7-aebf-418b-894c-9e0e6fac1c85
    type: regular
    task:
      id: 10f8f2a7-aebf-418b-894c-9e0e6fac1c85
      version: -1
      name: Clear found incident
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      all:
        simple: "no"
      key:
        simple: foundIncidents
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -100,
          "y": 1590
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "25":
    id: "25"
    taskid: 4bdcfbf0-bb58-4948-837e-6f2b77603ac7
    type: title
    task:
      id: 4bdcfbf0-bb58-4948-837e-6f2b77603ac7
      version: -1
      name: Check Search & Delete
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "27"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 1920
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "27":
    id: "27"
    taskid: 7dd81376-cd09-4f64-89bd-13fd23b18e9d
    type: playbook
    task:
      id: 7dd81376-cd09-4f64-89bd-13fd23b18e9d
      version: -1
      name: Check that soft delete was performed
      description: Waits for a certain task status, and/or completes the task.
      playbookName: Wait And Complete Task By Status
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      CompleteTask:
        simple: "False"
      IncidentID:
        complex:
          root: FoundID
      TaskName:
        simple: Search action - Soft delete.
      TaskStates:
        simple: Completed
    separatecontext: true
    loop:
      iscommand: false
      scriptArguments:
        CompleteTask:
          simple: "False"
        IncidentID:
          complex:
            root: HttpRequest.Response
            accessor: Body
            transformers:
            - operator: ParseJSON
            - operator: getField
              args:
                field:
                  value:
                    simple: id
        TaskName:
          simple: Get URL screenshot
        TaskStates:
          simple: Completed
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 2360,
          "y": 2050
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "28":
    id: "28"
    taskid: 3c67cd27-4144-40ba-8603-61fa1044d512
    type: regular
    task:
      id: 3c67cd27-4144-40ba-8603-61fa1044d512
      version: -1
      name: Error - email from is same as reporter, or reporter is empty
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: Either the Reporter Email Address is empty (problem with the mapper),
          or the Email From doesn't equal the Reporter Email Address (problem with
          Process Email - Generic subplaybook). In case of the latter, need to see
          if the original email was retrieved and parsed correctly using ParseEmailFiles.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -580,
          "y": 2320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "29":
    id: "29"
    taskid: 4d497d37-47d5-4418-82ca-248351d9052c
    type: condition
    task:
      id: 4d497d37-47d5-4418-82ca-248351d9052c
      version: -1
      name: Is the severity of the incident high?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "30"
      "yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              complex:
                root: foundIncidents
                accessor: severity
            iscontext: true
          right:
            value:
              simple: "3"
    view: |-
      {
        "position": {
          "x": -1120,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "30":
    id: "30"
    taskid: 694e0f51-ce81-4109-8c2b-680cd77967ca
    type: regular
    task:
      id: 694e0f51-ce81-4109-8c2b-680cd77967ca
      version: -1
      name: Error - final severity not calculated correctly
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The incident severity should be high, but it isn't. This could indicate one of the following problems:
          1. The threat intelligence integration used reached its quota.
          2. The threat intelligence integration used no longer detects the malicious URL as malicious.
          3. The way we calculate severity for incidents has changed.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -1120,
          "y": 2320
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "31":
    id: "31"
    taskid: 86b621db-0421-4676-8b91-1c97788b4f21
    type: condition
    task:
      id: 86b621db-0421-4676-8b91-1c97788b4f21
      version: -1
      name: Were the URLs extracted successfully?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "33"
      "yes":
      - "14"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: containsGeneral
          left:
            value:
              simple: URL.Data
            iscontext: true
          right:
            value:
              simple: http://157.230.37.22/banks/Scotia/
      - - operator: containsGeneral
          left:
            value:
              simple: URL.Data
            iscontext: true
          right:
            value:
              simple: http://www.scotiabank.com
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 2120
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "32":
    id: "32"
    taskid: 199a4d72-4f64-48db-80f8-fad95ae4368c
    type: regular
    task:
      id: 199a4d72-4f64-48db-80f8-fad95ae4368c
      version: -1
      name: Get the URL context
      description: Gets a value from the specified incident's context.
      scriptName: GetByIncidentId
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      get_key:
        simple: URL
      incident_id:
        complex:
          root: FoundID
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1230,
          "y": 1780
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "33":
    id: "33"
    taskid: c58ceafc-0cd1-4150-8fd1-a2955b9dd2fe
    type: regular
    task:
      id: c58ceafc-0cd1-4150-8fd1-a2955b9dd2fe
      version: -1
      name: The URLs were not extracted
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: The URLS were not extracted properly. The legitimate URL and the malicious
          URL should have been extracted using incident auto-extract settings or field
          extraction rules (in XSOAR 6.1+). If auto-extract is OK, it could be an
          issue with the threat intelligence integration.
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 2340
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "16_14_Yes": 0.12,
      "31_33_#default#": 0.59
    },
    "paper": {
      "dimensions": {
        "height": 2945,
        "width": 3860,
        "x": -1120,
        "y": 50
      }
    }
  }
inputs: []
outputs: []
fromversion: 6.0.0
